"use strict";angular.module("archiveApp",["ui.router","LocalStorageModule","chieffancypants.loadingBar","infinite-scroll","underscore"]).config(["$stateProvider","$urlRouterProvider",function(a){a.state("home",{url:"/",templateUrl:"views/main.html"}).state("list",{url:"/:collection",templateUrl:"views/list.html",controller:"ListController"}).state("detail",{url:"/detail/:id",templateUrl:"views/detail.html",controller:"DetailController"})}]);var underscore=angular.module("underscore",[]);underscore.factory("_",function(){return window._}),angular.module("archiveApp").controller("MainController",["$scope","Archive","$timeout",function(a,b){b.getIndex().then(function(b){a.bands=b})}]),angular.module("archiveApp").factory("Archive",["$http","$q","localStorageService",function(a,b,c){var d=c,e="https://archive.org/advancedsearch.php",f="https://archive.org/details/",g=function(){var c=b.defer();return d.get("idx")?c.resolve(d.get("idx")):a.get("index.json").success(function(a){c.resolve(a),d.set("idx",a)}),c.promise},h=function(c){var f=b.defer();return d.get(c)?f.resolve(d.get(c)):a({method:"JSONP",url:e,params:{q:'collection:"'+c+'"',"fl[]":["avg_rating","date","downloads","description","identifier","title"],"sort[]":["date desc","",""],rows:"10000",page:"1",indent:"yes",output:"json",callback:"JSON_CALLBACK",save:"yes"}}).success(function(a){f.resolve(a),d.set(c,a)}).error(function(a){f.reject(a)}),f.promise},i=function(c){var e=b.defer();return d.get(c)?e.resolve(d.get(c)):a({method:"JSONP",url:f+c,params:{output:"json",callback:"JSON_CALLBACK"}}).success(function(a){e.resolve(a),d.set(c,a)}),e.promise};return{getIndex:function(){return g()},getList:function(a){return h(a)},getShow:function(a){return i(a)}}}]),angular.module("archiveApp").controller("ListController",["$scope","Archive","$stateParams","_",function(a,b,c,d){var e;b.getList(c.collection).then(function(b){e=b.response.docs;var c=d.uniq(d.map(d.pluck(e,"date"),function(a){return parseInt(a.slice(0,4),10)}),!0);a.shows=e,console.log(e[0]),a.years=c,a.years.push("All"),a.limit=20}),a.loadMore=function(){a.limit+=20},console.log(c),a.yearOf=c.year,a.setYear=function(b){a.yearOf="All"===b?void 0:b}}]),angular.module("archiveApp").controller("DetailController",["$scope","Archive","$stateParams","$sce",function(a,b,c){b.getShow(c.id).then(function(b){console.log(b),a.data=b,a.metadata=b.metadata,a.item=b.item,a.reviews=b.reviews,a.files=b.files,a.misc=b.misc,a.filePath="http://archive.org/download/"+b.metadata.identifier[0]+"/"+b.metadata.identifier[0]+"_vbr_mp3.zip"})}]);